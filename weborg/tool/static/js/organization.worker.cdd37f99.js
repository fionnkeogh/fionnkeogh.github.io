!function(r){var e={};function n(t){if(e[t])return e[t].exports;var a=e[t]={i:t,l:!1,exports:{}};return r[t].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=r,n.c=e,n.d=function(r,e,t){n.o(r,e)||Object.defineProperty(r,e,{enumerable:!0,get:t})},n.r=function(r){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},n.t=function(r,e){if(1&e&&(r=n(r)),8&e)return r;if(4&e&&"object"===typeof r&&r&&r.__esModule)return r;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:r}),2&e&&"string"!=typeof r)for(var a in r)n.d(t,a,function(e){return r[e]}.bind(null,a));return t},n.n=function(r){var e=r&&r.__esModule?function(){return r.default}:function(){return r};return n.d(e,"a",e),e},n.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},n.p="/",n(n.s=0)}([function(r,e,n){"use strict";function t(r,e){(null==e||e>r.length)&&(e=r.length);for(var n=0,t=new Array(e);n<e;n++)t[n]=r[n];return t}function a(r,e){if(r){if("string"===typeof r)return t(r,e);var n=Object.prototype.toString.call(r).slice(8,-1);return"Object"===n&&r.constructor&&(n=r.constructor.name),"Map"===n||"Set"===n?Array.from(r):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(r,e):void 0}}function o(r){return function(r){if(Array.isArray(r))return t(r)}(r)||function(r){if("undefined"!==typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||a(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(r,e){return function(r){if(Array.isArray(r))return r}(r)||function(r,e){var n=null==r?null:"undefined"!==typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=n){var t,a,o=[],i=!0,u=!1;try{for(n=n.call(r);!(i=(t=n.next()).done)&&(o.push(t.value),!e||o.length!==e);i=!0);}catch(s){u=!0,a=s}finally{try{i||null==n.return||n.return()}finally{if(u)throw a}}return o}}(r,e)||a(r,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(r,e,n){return e in r?Object.defineProperty(r,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[e]=n,r}function s(r,e){return s=Object.setPrototypeOf||function(r,e){return r.__proto__=e,r},s(r,e)}function l(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(r){return!1}}function c(r,e,n){return c=l()?Reflect.construct:function(r,e,n){var t=[null];t.push.apply(t,e);var a=new(Function.bind.apply(r,t));return n&&s(a,n.prototype),a},c.apply(null,arguments)}n.r(e);var f=Symbol("Comlink.proxy"),h=Symbol("Comlink.endpoint"),y=Symbol("Comlink.releaseProxy"),v=Symbol("Comlink.thrown"),p=function(r){return"object"===typeof r&&null!==r||"function"===typeof r},d=new Map([["proxy",{canHandle:function(r){return p(r)&&r[f]},serialize:function(r){var e=new MessageChannel,n=e.port1,t=e.port2;return g(r,n),[t,[t]]},deserialize:function(r){return r.start(),m(r,[],e);var e}}],["throw",{canHandle:function(r){return p(r)&&v in r},serialize:function(r){var e=r.value;return[e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[]]},deserialize:function(r){if(r.isError)throw Object.assign(new Error(r.value.message),r.value);throw r.value}}]]);function g(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:self;e.addEventListener("message",(function n(t){if(t&&t.data){var a,s=Object.assign({path:[]},t.data),l=s.id,f=s.type,h=s.path,y=(t.data.argumentList||[]).map(j);try{var p=h.slice(0,-1).reduce((function(r,e){return r[e]}),r),d=h.reduce((function(r,e){return r[e]}),r);switch(f){case"GET":a=d;break;case"SET":p[h.slice(-1)[0]]=j(t.data.value),a=!0;break;case"APPLY":a=d.apply(p,y);break;case"CONSTRUCT":var A;a=O(c(d,o(y)));break;case"ENDPOINT":var m=new MessageChannel,S=m.port1,w=m.port2;g(r,w),a=E(S,[S]);break;case"RELEASE":a=void 0;break;default:return}}catch(A){a=u({value:A},v,0)}Promise.resolve(a).catch((function(r){return u({value:r},v,0)})).then((function(r){var t=i(k(r),2),a=t[0],o=t[1];e.postMessage(Object.assign(Object.assign({},a),{id:l}),o),"RELEASE"===f&&(e.removeEventListener("message",n),b(e))}))}})),e.start&&e.start()}function b(r){(function(r){return"MessagePort"===r.constructor.name})(r)&&r.close()}function A(r){if(r)throw new Error("Proxy has been released and is not useable")}function m(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},t=!1,a=new Proxy(n,{get:function(n,i){if(A(t),i===y)return function(){return T(r,{type:"RELEASE",path:e.map((function(r){return r.toString()}))}).then((function(){b(r),t=!0}))};if("then"===i){if(0===e.length)return{then:function(){return a}};var u=T(r,{type:"GET",path:e.map((function(r){return r.toString()}))}).then(j);return u.then.bind(u)}return m(r,[].concat(o(e),[i]))},set:function(n,a,u){A(t);var s=i(k(u),2),l=s[0],c=s[1];return T(r,{type:"SET",path:[].concat(o(e),[a]).map((function(r){return r.toString()})),value:l},c).then(j)},apply:function(n,a,o){A(t);var u=e[e.length-1];if(u===h)return T(r,{type:"ENDPOINT"}).then(j);if("bind"===u)return m(r,e.slice(0,-1));var s=i(S(o),2),l=s[0],c=s[1];return T(r,{type:"APPLY",path:e.map((function(r){return r.toString()})),argumentList:l},c).then(j)},construct:function(n,a){A(t);var o=i(S(a),2),u=o[0],s=o[1];return T(r,{type:"CONSTRUCT",path:e.map((function(r){return r.toString()})),argumentList:u},s).then(j)}});return a}function S(r){var e,n=r.map(k);return[n.map((function(r){return r[0]})),(e=n.map((function(r){return r[1]})),Array.prototype.concat.apply([],e))]}var w=new WeakMap;function E(r,e){return w.set(r,e),r}function O(r){return Object.assign(r,u({},f,!0))}function k(r){var e,n=function(r,e){var n="undefined"!==typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!n){if(Array.isArray(r)||(n=a(r))||e&&r&&"number"===typeof r.length){n&&(r=n);var t=0,o=function(){};return{s:o,n:function(){return t>=r.length?{done:!0}:{done:!1,value:r[t++]}},e:function(r){throw r},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,s=!1;return{s:function(){n=n.call(r)},n:function(){var r=n.next();return u=r.done,r},e:function(r){s=!0,i=r},f:function(){try{u||null==n.return||n.return()}finally{if(s)throw i}}}}(d);try{for(n.s();!(e=n.n()).done;){var t=i(e.value,2),o=t[0],u=t[1];if(u.canHandle(r)){var s=i(u.serialize(r),2);return[{type:"HANDLER",name:o,value:s[0]},s[1]]}}}catch(l){n.e(l)}finally{n.f()}return[{type:"RAW",value:r},w.get(r)||[]]}function j(r){switch(r.type){case"HANDLER":return d.get(r.name).deserialize(r.value);case"RAW":return r.value}}function T(r,e,n){return new Promise((function(t){var a=new Array(4).fill(0).map((function(){return Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)})).join("-");r.addEventListener("message",(function e(n){n.data&&n.data.id&&n.data.id===a&&(r.removeEventListener("message",e),t(n.data))})),r.start&&r.start(),r.postMessage(Object.assign({id:a},e),n)}))}function P(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function x(r,e){for(var n=0;n<e.length;n++){var t=e[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}function C(r,e,n){return e&&x(r.prototype,e),n&&x(r,n),Object.defineProperty(r,"prototype",{writable:!1}),r}var M=function(){function r(e,n,t){P(this,r),this.hash=void 0,this.verbose=void 0,this.hash=t||[],this.verbose=n}return C(r,[{key:"freeHash",value:function(){this.hash=[]}},{key:"insert",value:function(r){var e=r.getCardinality(),n=r.getHashString();return this.hash[e]&&this.hash[e].has(n)?(this.verbose&&console.debug("Set already processed.",[e,n]),!1):(this.hash[e]||(this.hash[e]=new Map),this.hash[e].set(n,1),this.verbose&&console.debug("Set inserted.",[e,n]),!0)}},{key:"freeHashBelow",value:function(r){for(var e=0;e<r;e++)this.hash[e]&&(this.hash[e]=new Map);this.verbose&&console.debug("Freed Hash below.",r)}}]),r}(),R=function(){function r(e,n){P(this,r),this.hashString="",this.cardinality=void 0,this.species=void 0,this.booleanArray=void 0,this.species=e,this.cardinality=e.length,this.booleanArray=new Array(n).fill(!1);for(var t=0,a=e.length;t<a;t++){var o=e[t].index;this.booleanArray[o]=!0}this.hashString=this.arrayToString()}return C(r,[{key:"hasSpecies",value:function(r){return this.booleanArray[r.index]}},{key:"addSpecies",value:function(r){return!1===this.hasSpecies(r)&&(this.species.push(r),this.cardinality=this.species.length,this.booleanArray[r.index]=!0,this.hashString=this.arrayToString(),!0)}},{key:"getSpecies",value:function(r){return this.species[r]}},{key:"getSpeciesFromID",value:function(r){for(var e=0;e<this.cardinality;e++)if(this.species[e].index===r)return this.species[e];return this.species[0]}},{key:"getHashString",value:function(){return this.hashString}},{key:"getBooleanArray",value:function(){return this.booleanArray}},{key:"getCardinality",value:function(){return this.cardinality}},{key:"toString",value:function(){for(var r="{",e=0,n=this.cardinality;e<n;e++)r=r+" ["+this.species[e].toString()+"]";return r+=" }"}},{key:"arrayToString",value:function(){for(var r="",e=0,n=this.booleanArray.length;e<n;e++)!0===this.booleanArray[e]?r+="1":r+="0";return r}}]),r}();e.default={};function L(r,e){return!1===r.hasSpecies(e)&&(r.species.push(e),r.cardinality=r.species.length,r.booleanArray[e.index]=!0,r.hashString=function(r){for(var e="",n=0,t=r.booleanArray.length;n<t;n++)!0===r.booleanArray[n]?e+="1":e+="0";return e}(r),!0)}function I(r,e){for(var n=r.length,t=e.booleanArray.length,a=!0;!0===a;){a=!1;for(var o=0;o<n;o++){var i=r[o];if(D(e,i.reactants))for(var u=i.products,s=0;s<t;s++)!0===u.booleanArray[s]&&!1===e.booleanArray[s]&&(L(e,_(u,s)),a=!0)}}return e}function _(r,e){for(var n=0;n<r.cardinality;n++)if(r.species[n].index===e)return r.species[n];return r.species[0]}function D(r,e){for(var n=r.booleanArray,t=e.booleanArray,a=0,o=n.length;a<o;a++)if(!1===n[a]&&!0===t[a])return!1;return!0}function H(r,e){for(var n=0,t=r.length;n<t;n++)if(r[n].hashString===e.hashString)return!0;return!1}function N(r,e){for(var n=0,t=r.length;n<t;n++)if(r[n].join("")===e.join(""))return!0;return!1}function z(r){for(var e=r[0],n=0,t=1,a=r.length;t<a;t++)r[t].cardinality<e.cardinality&&(e=r[t],n=t);return n}g({connected:!1,organizations:[],calculateOrganizations:function(r,e,n,t,a){var i=void 0,u=[];try{u=this.computeSemiOrganizations(t,n,r,e)}catch(y){i=y,console.error(y)}for(var s=[],l=0;l<u.length;l++){for(var c=[],f=0;f<u[l].cardinality;f++)c.push(u[l].species[f]);var h={hashString:u[l].hashString,cardinality:u[l].cardinality,species:c,booleanArray:u[l].booleanArray.map((function(r){return!0===r?1:0}))};s.push([h.cardinality].concat(o(h.booleanArray)))}a(s.flat(),e,i)},computeSemiOrganizations:function(r,e,n,t){var a=e.length,o=new M(a,t),i=new Array(0),u=new Array(0);for(u.push(I(r,new R(new Array(0),a)));u.length>0;){var s=z(u),l=u[s],c=this.SOsDirectlyAbove(l,r,e,o,n);H(i,l)||i.push(l);for(var f=0,h=c.length;f<h;f++)H(u,c[f])||u.push(c[f]);u.splice(s,1),!0===t&&console.log("INTERMEDIATE-RESULTS: ".concat(u.length," SOsToCheck left."))}if(!0===t){console.log("RESULTS:");for(var y=0;y<i.length;y++)console.log(i[y].toString())}return i},SOsDirectlyAbove:function(r,e,n,t,a){var o=new Array(0),i=e.length,u=n.length,s=r.booleanArray,l=new Array(0),c=u-r.cardinality;if(t.freeHashBelow(r.cardinality),!1===a||0===r.cardinality){if(0!==c)for(var f=0,h=0;f<c;f++){for(;!0===s[h];)h++;var y=new R(new Array(0),u);L(y,n[h++]),l.push(y)}}else{for(var v=0;v<i;v++){var p=e[v];if(!D(r,p.reactants))for(var d=p.reactants.booleanArray,g=p.products.booleanArray,b=0;b<u;b++)if(!0===s[b]&&(!0===g[b]||!0===d[b])){for(var A=new R(new Array(0),u),m=0;m<u;m++){if(!0===d[m]&&!1===s[m])L(A,n[m])}H(l,A)||l.push(A)}}c=l.length}for(var S=0;S<c;S++)for(var w=this.SOsDirectlyAboveContaining(r,l[S],n,e,t),E=0;E<w.length;E++)H(o,w[E])||o.push(w[E]);return o},SOsDirectlyAboveContaining:function(r,e,n,t,a){for(var o=[],i=e.booleanArray.length,u=new R(new Array(0),i),s=0;s<i;s++)!0===r.booleanArray[s]&&!1===u.booleanArray[s]&&L(u,n[s]);for(var l=0;l<i;l++)!0===e.booleanArray[l]&&!1===u.booleanArray[l]&&L(u,n[l]);if(u=I(t,u),!1===a.insert(u))return o;var c=new R(new Array(0),u.booleanArray.length),f=new R(new Array(0),u.booleanArray.length);if(this.getProducedConsumedSpecies(c,f,u,n,t),D(f,c))H(o,u)||o.push(u);else{for(var h=c.booleanArray,y=f.booleanArray,v=new R(new Array(0),i),p=0;p<i;p++)!0===h[p]&&!1===y[p]&&L(v,n[p]);for(var d=this.producerSets(v,n,t),g=0;g<d.length;){for(var b=new R(new Array(0),i),A=0;A<i;A++)!0!==u.booleanArray[A]&&!0!==d[g].booleanArray[A]||L(b,n[A]);for(var m=this.SOsDirectlyAboveContaining(r,b,n,t,a),S=0;S<m.length;S++)H(o,m[S])||o.push(m[S]);g++}}return o},getProducedConsumedSpecies:function(r,e,n,t,a){for(var o=n.booleanArray.length,i=0;i<a.length;i++){var u=a[i];if(D(n,u.reactants))for(var s=u.stoichiometry.slice(0,t.length),l=u.stoichiometry.slice(t.length),c=0;c<o;c++)l[c]>s[c]&&L(e,t[c]),l[c]<s[c]&&L(r,t[c])}},producerSets:function(r,e,n){for(var t=new Array(0),a=r.cardinality,o=new Array(a),i=new Array(a).fill(0),u=r.booleanArray.length,s=n.length,l=r.booleanArray,c=0,f=-1;c<a;c++){for(o[c]=new Array(0),f++;l[f];)f++;for(var h=0;h<s;h++){var y=n[h],v=y.stoichiometry.slice(0,e.length),p=y.stoichiometry.slice(e.length),d=r.species[f]?r.species[f].index:f;if(p[d]>v[d]){var g=y.reactants.booleanArray.map((function(r){return!0===r?1:0}));N(o[c],g)||(o[c].push(g),i[c]++)}}}for(var b=new Int32Array(a).fill(0),A=1,m=0;m<a;m++)A*=i[m];for(var S=0;S<A;S++){for(var w=new Array(u).fill(0),E=0;E<a;E++)for(var O=0;O<u;O++)1===o[E][b[E]][O]&&(w[O]=1);for(var k=new R(new Array(0),u),j=0;j<u;j++)1===w[j]&&L(k,e[j]);H(t,k)||t.push(k);for(var T=a-1;T>=0;T--)if(b[T]<i[T]-1){b[T]++;for(var P=T+1;P<a;P++)b[P]=0;break}}return t}})}]);
//# sourceMappingURL=organization.worker.cdd37f99.js.map